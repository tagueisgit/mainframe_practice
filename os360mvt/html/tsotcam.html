<html>
<head>
<title>OS/360 on Hercules: Building and installing TSO and TCAM</title>
<h1>OS/360 on Hercules: Building and installing TSO and TCAM</h1>
</head>
<body>
<hr>
<h3>11. Building and installing TSO and TCAM</h3>
<h4><a name="11.1">11.1 Overview</a></h4>
<p>While the structure of TSO is quite a bit different in MVT from what it
became in later OSes, the function is definitely the same. The main
difference is that, unlike in MVS, TSO users have a small piece of the
address space which they share among themselves via a swapping mechanism
managed by the TSO main task.</p>
<p>VTAM hadn't been invented yet, so all TSO use is through TCAM. TCAM
is capable of controlling local 3270, remote 3270, and remote line-mode
terminal devices; Hercules currently emulatesonly the first, so that's what
we will set up. The procedure here will generate a TCAM with exactly one
local 3270 device defined to it. Extending that definition to define
multiple 3270s is straightforward.</p>
<h4><a name="11.2">11.2 TCAM and TSO JCL: TCAMPRCS</a></h4>
<p>The first step is to add JCL procs for TSO and TCAM to the
<code>SYS1.PROCLIB</code> dataset. This job does that. It can be found in
<code>jcl/tcamprcs.jcl</code>.</p>
<h4><a name="11.3">11.3 TSO parameters: TSOSETUP</a></h4>
<p>This job does two things:
<ul>
<li>The first step, IKJPRM00, defines the parameters for the TSO
controlling task. It adds the parameters to SYS1.PARMLIB via IEBUPDTE.
<li>The second step allocates two datasets:
<ul>
<li><code>SYS1.BRODCAST</code>, as it does in later versions, contains all
messages sent to a user by the SEND command and saved for later reading
because the user was not logged on.
<li><code>SYS1.SWAP0</code> is the swap dataset managed by TSO to swap users
in and out of memory.
</ul>
</ul>
It's in <code>jcl/tsosetup.jcl</code>.</p>
<h4><a name="11.4">11.4 TCAM stage 1: TCAMSTG1</a></h4>
<p>TCAM is generated by a stage 1/stage 2 process similar to the OS itself.
Fortunately, both steps are quite a bit simpler than those. Stage 1 is
done by feeding a source deck to the assembler, which produces assembler
output that builds the actual TCAM message control program (MCP). Stage 1
is in <code>jcl/tcamstg1.jcl</code>. Before starting it, if HASP is not
running, you need to start a writer for the punch output in SYSOUT class B.
Do this by entering the command
<pre>
s wtr,00d,,b
</pre> on the MVT console.
If HASP is running, this is unnecessary, as it automatically runs the writer
for you.</p>
<h4><a name="11.5">11.5 TCAM stage 2: TCAMSTG2</a></h4>
Unlike the OS generation, TCAM's stage 1 output is just an assembler program.
To build the MCP, the assembler source must be fed to the assembler by
wrapping JCL around it and feeding it to the card reader. The JCL is in
<code>jcl/tcamstg2.txt</code>. Edit this file, insert the contents of
<code>pch00d.txt</code> where the comment (surrounded by rows of !!!!! -
delete those) indicates it should go, save the modified JCL as
<code>jcl/tcamstg2.jcl</code>, then run that. The supplied
<code>jcl/tcamstg2.jcl</code> file is the result of running the supplied
stage 1 gen, and may be used unmodified if the stage 1 deck has not been
changed.</p>
<h4><a name="11.6">11.6 Starting TCAM and TSO</a></h4>
<p>TCAM may be started, once the stage 2 is complete, by entering the
command
<pre>
s tcam
</pre> on the MVT console. Aside from the message that says TCAM has
been started, nooutput will be produced. Start TSO by entering
<pre>
s tso
</pre>
This will be more verbose:
<pre>
      IEF403I TSO      STARTED    TIME=13.20.22          
      IKJ017I SMF NOT ACTIVE - SMF PARAMETER IGNORED     
      IKJ016I REGNMAX=1  - REGIONS STARTING=1            
      IKJ030I SYSWAP00,000300,000300 SWAP DATA SET FORMAT
      IKJ090I TSO DUMP FUNCTION INOPERATIVE              
      IKJ052I TIME SHARING REGION 01 HAS STARTED         
      IKJ019I TSO HAS BEEN INITIALIZED                   
</pre>The <code>IKJ030I</code> message will only be produced the first
time TSO is started. At this point, it's all running.</p>
<h4><a name="11.7">11.7 Logging on to TSO</a></h4>
<p>Logging on under TCAM is finicky, at least on MVT. To log on, you
must follow these steps:
<ul>
<li>Press the 3270 CLEAR key. If you're using the x3270 program on
Linux, this key is simulated by alt-C; if you're running something else,
consult that program's documentation.
<li>Look for the message
<pre>
IKJ54012A ENTER LOGON -
</pre> This message is issued by TCAM.
<li>Position the cursor at the beginning of this message. The backwards tab
(shift-TAB) key might do it, or possibly the HOME key.
<li>Type LOGON <i>userid</i>. If you've not created any other users, the
only valid user ID will be IBMUSER.
<li>Hit the erase EOF key. In x3270, this key is alt-E.
<li>Hit ENTER.
</ul>
If all went well, you'll be greeted with:
<pre>
 IBMUSER LOGON IN PROGRESS AT 13:42:21 ON FEBRUARY 14, 1975
 NO BROADCAST MESSAGES 
 READY  
</pre>
The first time, you'll get a complaint about the broadcast dataset being
unusable. This will be corrected when you define another user ID. To
do so, logon as IBMUSER, then do:
<pre>
<i>account</i>
</pre>
You'll be greeted with:
<pre>
ACCOUNT
</pre>This tells you you're in ACCOUNT mode. This is the program that is
used to define TSO users. Enter
<pre>
<i>add (</i>userid<i> * * ikjaccnt) oper acct jcl size(44)</i>
</pre>
This will define a new user with the id <i>userid</i>. TSO user IDs must
be no longer than 7 characters. The new user ID will have all of the
same capabilities as IBMUSER, which is everything. As a side effect, the
broadcast dataset will be formatted. Exit ACCOUNT by entering
<pre>
<i>end</i>
</pre>
This will return you to the READY prompt.</p>
<h4><a name="11.8">11.8 Shutting down TSO and TCAM</a></h4>
<p>To shut down TSO, enter
<pre>
<i>p tso</i>
</pre>on the MVT console. This will produce:
<pre>
      IKJ078I TSO      TSO      TSO IS STOPPING
      05 IKJ024D TSO STOP IN PROGRESS, REPLY 'U' OR 'FSTOP'
      IKJ051I TIME SHARING REGION 01 HAS TERMINATED
      IEE400I THESE MESSAGES CANCELLED - 05.
      IKJ085I  TSO MODIFY/STOP SUBTASK TERMINATED
      IEF404I TSO      ENDED      TIME=13.53.24
</pre>
The message IKJ024D will automatically be replied to, so you don't have to
reply yourself.</p>
<p>To shut down TCAM, enter
<pre>
<i>z tp</i>
</pre>on the MVT console. This will produce:
<pre>
      IED097I TCAM IS CLOSED DOWN
    - IEF404I TCAM     ENDED      TIME=13.55.58
</pre>At this point, TCAM and TSO are down. The system may be shut down if
desired.</p>
<hr>
<p><a href="index.html">Up to table of contents</a>
<a href="hasp.html">Previous: Building and installing HASP</a>
<a href="whatsnext.html">Next: What's next?</a>
</p>
<hr>
<address>
<a href="http://http://www.conmicro.cx/">Jay Maynard,
jmaynard@conmicro.cx</a>
</address><p>
Last updated 14 February 2003
</body>
</html>
